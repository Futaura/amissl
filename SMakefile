SRC_D=src
OBJ_D=obj
OUTDIR=LIBS:
LIBCPU=68000
LIBSSL=openssl/$(LIBCPU)/out/ssl.lib
LIBCRYPTO=openssl/$(LIBCPU)/out/crypto.lib
STRIPDEBUG=
LIBVERSIONNAME=097e
LIBVERSION=3
LIBREVISION=1
LIBVERSIONFULL=$(LIBVERSION).$(LIBREVISION)

OPTIMS=#OPT OPTGO OPTPEEP OPTLOOP OPTINL OPTINLOCAL OPTDEP=4 OPTSCHED
CFLAGS=$(OPTIMS) DEF __USE_SYSBASE=1 IDLEN=100 DEF __builtin_memcmp=memcmp \
       IDIR AmiSSL:Include NOSTACKCHECK DEBUG=LINE LIBCODE

all: amissl_v$(LIBVERSIONNAME).library amisslmaster.library

clean:
	-rm obj/*.o

copylibs:
	Move amisslmaster.library $(OUTDIR)amisslmaster.library
	Move amissl_v$(LIBVERSIONNAME).library $(OUTDIR)amissl/amissl_v$(LIBVERSIONNAME).library

$(OBJ_D)/amissl_glue.o: $(SRC_D)/amissl_glue.c
	sc $* OBJNAME $@ $(CFLAGS) CODE=FAR

$(OBJ_D)/amissl_library.o: $(SRC_D)/amissl_library.c
	sc $* OBJNAME $@ $(CFLAGS)

$(OBJ_D)/amisslmaster_library.o: $(SRC_D)/amisslmaster_library.c
	sc $* OBJNAME $@ $(CFLAGS)

amissl_v$(LIBVERSIONNAME).library: $(OBJ_D)/amissl_library.o $(OBJ_D)/amissl_glue.o
	slink WITH <<
DEFINE _bsearch=_OBJ_bsearch
DEFINE __XCEXIT=_AmiSSLAbort
DEFINE @abort=_AmiSSLAbort
DEFINE @__chkabort=@__dummy
DEFINE _RAND_add_internal=_RAND_add
DEFINE _BIO_new_fp=@__dummy
DEFINE _closelog=@__dummy
DEFINE _openlog=@__dummy
DEFINE _DummyFunc=@__dummy
LIBFD FD/amissl_lib.fd
LIBPREFIX __AmiSSL_
LIBID "$@ $(LIBVERSIONFULL) ($(DATE))"
TO amissl_v$(LIBVERSIONNAME).library
FROM lib:libent.o lib:libinitr.o $(OBJ_D)/amissl_library.o $(OBJ_D)/amissl_glue.o
LIB $(LIBCRYPTO) $(LIBSSL) \
    libcmt/libcmt.lib LIB:multitcp.lib lib:debug.lib LIB:scm.lib LIB:sc.lib lib:amiga.lib 
MAP $>.map HXSFLO PLAIN HEIGHT 0 SWIDTH 32 HWIDTH 16 PWIDTH 16 FWIDTH 32
NOICONS
BATCH
SMALLCODE
LIBVERSION $(LIBVERSION) LIBREVISION $(LIBREVISION)
$(STRIPDEBUG)
<

amisslmaster.library: $(OBJ_D)/amisslmaster_library.o
	slink WITH <<
LIBFD FD/amisslmaster_lib.fd
LIBID "$@ $(LIBVERSIONFULL) ($(DATE))"
TO amisslmaster.library
FROM lib:libent.o lib:libinitr.o $(OBJ_D)/amisslmaster_library.o
LIB LIB:sc.lib
MAP $>.map HXSFLO PLAIN HEIGHT 0 SWIDTH 32 HWIDTH 16 PWIDTH 16 FWIDTH 32
NOICONS
BATCH
SMALLCODE SMALLDATA
LIBVERSION $(LIBVERSION) LIBREVISION $(LIBREVISION)
$(STRIPDEBUG)
<
